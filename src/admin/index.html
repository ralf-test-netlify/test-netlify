<!doctype html>
<html>
<head>
  <meta charset='utf-8'/>
  <meta name='viewport'
      content='width=device-width, initial-scale=1.0'/>
  <title>Content Manager</title>

  <link rel='stylesheet'
      href='https://unpkg.com/netlify-cms@^0.3/dist/cms.css'/>

  <style type='text/css' media='screen'>
    #editorDiv {
      width: 400px;
      height: 400px;
    }
  </style>

</head>
<body>
<script src='https://unpkg.com/netlify-cms@^0.3/dist/cms.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js'></script>
<script>
  var AceControl = createClass({
    displayName: 'AceControl',
    handleChange: function (e) {
      console.log('handleChange: Who is calling it?', e);
    },

    componentDidMount: function(){
      console.info('componentDidMount', document.getElementById('editorDiv'));
      var self = this;
      self.editor = ace.edit('editorDiv');
      self.editor.setTheme('ace/theme/monokai');
      self.editor.getSession().setMode('ace/mode/json');
      self.editor.getSession().on('change', function(e){
        console.log('ace on change', e, self.editor.getValue());
        self.props.onChange(self.editor.getValue())
      });
    },

    componentDidUpdate: function(){

    },

    render: function () {
      console.log('render', this.props.value)
      var value = this.props.value || '';
      return h('div', {id: 'editorDiv'}, value);
    }
  });
  var JsonPreviewControl = createClass({
    render: function () {
      var value = this.props.value || '';
      return h('pre', {}, value);
    }
  });

  CMS.registerWidget('ace', AceControl, JsonPreviewControl);
</script>
</body>
</html>