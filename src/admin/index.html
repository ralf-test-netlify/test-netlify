<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport"
      content="width=device-width, initial-scale=1.0"/>
  <title>Content Manager</title>

  <link rel="stylesheet"
      href="https://unpkg.com/netlify-cms@^0.3/dist/cms.css"/>

</head>
<body>
<script src="https://unpkg.com/netlify-cms@^0.3/dist/cms.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js"></script>
<script>
  var AceControl = createClass({
    displayName: 'AceControl',
    handleChange: function (e) {
      console.log('handleChange: Who is calling it?', e);
      debugger;
    },

    componentDidMount: function(){
      console.info('componentDidMount', document.getElementById('editorDiv'));
      var self = this;
      var editor = ace.edit("editorDiv");
      editor.setTheme("ace/theme/monokai");
      editor.getSession().setMode("ace/mode/json");
      editor.getSession().on('change', function(e){
        console.log('ace on change', e);
        self.props.onChange(e.value)
      })
    },

    render: function () {
      var value = this.props.value || '';
      return h('div', {id: 'editorDiv'}, value);
    }
  });
  var JsonPreviewControl = createClass({
    render: function () {
      var value = this.props.value || '';
      return h('pre', {}, value);
    }
  });

  CMS.registerWidget('ace', AceControl, JsonPreviewControl);
</script>
</body>
</html>